syntax = "proto3";

package cloud.planton.apis.iac.v1.stackjob.model.progress.snapshot;

import "cloud/planton/apis/iac/v1/stackjob/model/state.proto";

//complete snapshot of a stack-job log
message StackJobProgressSnapshot {
  //status of the stack-job
  cloud.planton.apis.iac.v1.stackjob.model.StackJobStatusProgressStatus job_progress = 1;
  //snapshot of 'pulumi refresh' operation
  StackJobProgressPulumiOperationSnapshot refresh_snapshot = 2;
  //snapshot of 'pulumi preview'(apply) operation
  StackJobProgressPulumiOperationSnapshot apply_preview_snapshot = 3;
  //snapshot of 'pulumi preview'(destroy) operation
  StackJobProgressPulumiOperationSnapshot destroy_preview_snapshot = 4;
  //snapshot of 'pulumi up' operation
  StackJobProgressPulumiOperationSnapshot apply_snapshot = 5;
  //snapshot of 'pulumi destory' operation
  StackJobProgressPulumiOperationSnapshot destroy_snapshot = 6;
}

//snapshot of the pulumi operation
message StackJobProgressPulumiOperationSnapshot {
  //status of the pulumi operation
  cloud.planton.apis.iac.v1.stackjob.model.StackJobStatusPulumiOperationStatus status = 1;
  //prelude events generated by pulumi engine
  PulumiOperationPreludeSnapshot prelude = 2;
  //resource-changes generated by pulumi engine
  PulumiOperationResourceChangesSnapshot resource_changes = 3;
  //resource diff generated by pulumi engine
  PulumiOperationDiffSnapshot diff = 4;
  //diagnostic events generated by pulumi engine
  PulumiOperationDiagnosticsSnapshot diagnostics = 5;
  //summary event generated by pulumi engine
  PulumiOperationSummarySnapshot summary = 6;
}

message PulumiOperationPreludeSnapshot {
  repeated string prelude_message = 1;
}

message PulumiOperationResourceChangesSnapshot {
  map<string,PulumiOperationResourceChangesSnapshotRow> urn_to_row_map = 1;
}

message PulumiOperationDiffSnapshot {
  repeated string resource_diff = 1;
}

message PulumiOperationDiagnosticsSnapshot {
  repeated string diagnostic_message = 1;
}

message PulumiOperationSummarySnapshot {
  int32 duration_seconds = 1;
  int32 unchanged_resource_count = 2;
  int32 create_resource_count = 3;
  int32 update_resource_count = 4;
  int32 delete_resource_count = 5;
  int32 replace_resource_count = 6;
}

message PulumiOperationResourceChangesSnapshotRow {
  string resource_kind = 1;
  string resource_name = 2;
  string status = 3;
  bool is_done = 4;
  bool is_failed = 5;
  int64 elapsed_duration_seconds = 6;
}
