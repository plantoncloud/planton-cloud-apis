syntax = "proto3";

package cloud.planton.apis.iam.v1.identityaccount.model;

import "buf/validate/validate.proto";
import "cloud/planton/apis/commons/apiresource/model/state.proto";
import "cloud/planton/apis/commons/apiresource/options/apiresourcefieldoptions/api_resource_field_options.proto";
import "cloud/planton/apis/commons/apiresource/options/apiresourcemessageoptions/api_resource_message_options.proto";
import "cloud/planton/apis/iam/v1/identityaccount/enums/identityaccounttype/identity_account_type.proto";

// identity-account for user-account or machine-account
message IdentityAccount {
  option (cloud.planton.apis.commons.apiresource.options.apiresourcemessageoptions.resource_kind) = identity_account;

  //resource api-version
  string api_version = 1 [
    (buf.validate.field).string.const = "code2cloud.planton.cloud/v1"
  ];

  //resource kind
  string kind = 2 [
    (buf.validate.field).string.const = "IdentityAccount"
  ];

  // metadata for the resource
  // id:
  // (read-only) this is generated by idp provider.
  // for user accounts it can be in different formats.
  // * "auth0|<random-string>" when user signs up using email/password.
  // * "google-oauth|<random-string>" when user signs up using google.
  // for machine accounts it is the client_id of the oauth application created for the
  // m2m app on idp provider and is stored in the planton cloud database.
  //
  // name:
  //
  // name of the machine account.
  // name must match the regex '^[A-Za-z0-9-]{6,16}$'.
  // It represents a string of 6-16 alphanumeric characters or hyphens, with no spaces or other special characters.
  cloud.planton.apis.commons.apiresource.model.ApiResourceMetadata metadata = 3;

  // resource spec
  IdentityAccountSpec spec = 4;

  // resource status
  IdentityAccountStatus status = 5;
}

// resource spec for identity-account
message IdentityAccountSpec {
  // this is only relevant in case of machine identity accounts.
  // machine accounts are associated to companies on creation.
  string company_id = 1 [
    (buf.validate.field).string.min_len = 1,
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_immutable) = true
  ];
  // identity account type to identify with the account is for a machine or user
  cloud.planton.apis.iam.v1.identityaccount.enums.identityaccounttype.IdentityAccountType identity_account_type = 2 [
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_required) = true,
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_immutable) = true
  ];
  // email of the identity account.
  // (ignored for create) this value is assigned by planton backend.
  // the format for email for machine account is <machine-account-name>@<owner-id>.iam.pmachineaccount.com
  // <machine-account-name> is entered by user at the time of creation of machine accounts
  // (update not allowed)
  // email in case user account is based on the email used to signup to the application.
  string email = 3 [
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_computed) = true
  ];
  // first name of the identity account this is more relevant in case of user accounts.
  // first name might be blank in case of machine accounts
  string first_name = 4;
  // last name of the identity account this is more relevant in case of user accounts.
  // last name might be blank in case of machine accounts
  string last_name = 5;
  // (read-only) url of the identity account on idp.
  // this is constructed when a client requests for the account object.
  // the format of the url for machine accounts is https://manage.auth0.com/dashboard/us/<auth0-tenant>/applications/<client-id>/settings
  // ex: https://manage.auth0.com/dashboard/us/planton-pcs-dev/applications/pKfND0v14bJRhk8XOFGVFY15H9gNHIov/settings
  // the format of the url for user accounts is https://manage.auth0.com/dashboard/us/<auth0-tenant>/users/<client-id>/settings
  // ex: https://manage.auth0.com/dashboard/us/planton-pcs-dev/users/pKfND0v14bJRhk8XOFGVFY15H9gNHIov/settings
  string idp_url = 6 [
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_computed) = true
  ];
  //url of the profile picture for the user on auth0
  string picture_url = 7 [
    (cloud.planton.apis.commons.apiresource.options.apiresourcefieldoptions.is_computed) = true
  ];
}

// resource status for identity-account
message IdentityAccountStatus {
  // lifecycle of the resource
  cloud.planton.apis.commons.apiresource.model.ApiResourceLifecycle lifecycle = 99;

  // resource audit info
  cloud.planton.apis.commons.apiresource.model.ApiResourceAudit audit = 98;
}

// https://auth0.com/docs/customize/log-streams/custom-log-streams
message Auth0Webhook {
  string date = 1;
  string type = 2;
  string description = 3;
  string client_id = 4;
  string client_name = 5;
  string ip = 6;
  string user_agent = 7;
  string user_id = 8;
}
