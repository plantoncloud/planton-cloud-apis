syntax = "proto3";

//Domain Objects in this project are used internally and are not to be used by any of the Billing API clients which include Web Apps, Mobile Apps and the CLI.
//The domain objects defined in this package are used for the state processing.
package cloud.planton.apis.v1.billing.state;

import "cloud/planton/apis/v1/commons/audit/model.proto";
import "cloud/planton/apis/v1/commons/resource/model.proto";
import "cloud/planton/apis/v1/commons/resource/options/resource_options.proto";
import "cloud/planton/apis/v1/stack/state/model.proto";
import "cloud/planton/apis/v1/billing/state/enums/enums.proto";
import "cloud/planton/apis/v1/commons/resource/enums/enums.proto";

//billing-account state
message BillingAccountState {
  option (cloud.planton.apis.v1.commons.resource.options.resource_type) = billing;
  option (cloud.planton.apis.v1.commons.resource.options.is_runnable) = false;
  option (cloud.planton.apis.v1.commons.resource.options.owner).type = company;
  option (cloud.planton.apis.v1.commons.resource.options.owner).id_field_path = "spec.company_id";
  // event-type
  cloud.planton.apis.v1.billing.state.enums.BillingAccountEventType event_type = 99;

  // resource api version
  string api_version = 1;

  // resource kind
  string kind = 2;

  // metadata for the resource
  // identifier for billing account
  // name of the billing account.
  cloud.planton.apis.v1.commons.resource.Metadata metadata = 3;
  // spec
  BillingAccountSpecState spec = 4;
  // status
  BillingAccountStatusState status = 5;
}

// specification for billing-account.
// a billing account is created upon company creation.
message BillingAccountSpecState {
  // The unique identifier for the company for which the billing account is created.
  // It's a unique alphanumeric string used to identify a specific company within your service.
  string company_id = 1;
  // Represents the customer's information on Stripe.
  // StripeCustomer is a separate message, not shown here, which presumably includes necessary
  // Stripe-specific information like the customer ID, email, etc.
  StripeCustomer stripe_customer = 2;
  // A list of BillingSubscription objects associated with this billing account.
  // BillingSubscription is another message type, not shown here, which contains details about individual subscriptions.
  repeated BillingSubscriptionState subscriptions = 3;
}


message BillingSubscriptionState {
  // System audit information associated with this billing subscription.
  // SysAudit is a separate message defined elsewhere, which includes necessary system audit information.
  cloud.planton.apis.v1.commons.audit.SysAudit sys_audit = 99;

  // Unique identifier for the specific billing subscription.
  // This identifier is unique per billing subscription and is used to correlate the billing subscription with its associated data.
  string id = 1;

  // StripeSubscription object associated with this billing subscription.
  // StripeSubscription is a separate message, which includes necessary Stripe-specific subscription information.
  StripeSubscription subscription = 2;

  // List of BillingItemState objects associated with this billing subscription.
  // BillingItemState is another message type, containing details about individual billing items.
  repeated BillingItemState billing_items = 3;
}



message StripeCustomer {
  //id of the customer created for the company on stripe
  string customer_id = 1;
}

message StripeSubscription {
  //id of the subscription created for the company on stripe
  string subscription_id = 1;
}

//status for billing-account
message BillingAccountStatusState {
  // resource lifecycle
  cloud.planton.apis.v1.commons.resource.ResourceLifecycle lifecycle = 99;
  // system audit info
  cloud.planton.apis.v1.commons.audit.SysAudit sys_audit = 98;
  // stack-job that produced the status
  cloud.planton.apis.v1.stack.state.StackJobState stack_job = 97;
}

// BillingItemState is a protocol message that represents the state of a billing item.
// This message is used to manage and track billing related information for various resources.
message BillingItemState {
  // System audit information associated with this billing item.
  // SysAudit is a separate message defined elsewhere, which includes necessary system audit information.
  cloud.planton.apis.v1.commons.audit.SysAudit sys_audit = 99;

  // Unique identifier for the specific billing item.
  // This identifier is unique per billing item and is used to correlate the billing item with its associated data.
  string id = 1;

  // Specifies the type of the resource being billed using an enumeration from the cloud.planton.apis.v1.commons.resource.enums package.
  // The resource type helps categorize and manage resources more effectively, ensuring the right billing strategy for each type.
  cloud.planton.apis.v1.commons.resource.enums.ResourceType resource_type = 2;

  // StripeSubscriptionItem object associated with this billing item.
  // StripeSubscriptionItem is a separate message, which includes necessary Stripe-specific subscription item information.
  StripeSubscriptionItem subscription_item = 3;

  // Represents the association between a billing subscription item and its corresponding resources.
  // Each entry in this list maps a billing subscription item to a specific resource, allowing for a one-to-many relationship.
  // This ensures that a single billing subscription item can be associated with multiple resources.
  repeated BillingSubscriptionResourceMappingState resource_mapping = 4;
}

// Represents the mapping state of a billing subscription to a resource.
// This message provides details about the association between a billing subscription and a specific resource.
message BillingSubscriptionResourceMappingState {
  // System audit information, containing metadata like creation and modification timestamps.
  cloud.planton.apis.v1.commons.audit.SysAudit sys_audit = 99;

  // Unique identifier for the billing subscription resource mapping.
  string id = 1;

  // Identifier for the associated resource.
  string resource_id = 2;
}

message StripeSubscriptionItem {
  // stripe_price_id represents the unique identifier for the price of the resource in Stripe.
  // Stripe is a payment processing platform, and each distinct price point or billing model has a unique identifier within Stripe.
  // This field corresponds to this identifier and is used for billing and payment processing.
  string price_id = 1;
  // stripe_subscription_item_id represents the unique identifier for the subscription item in Stripe.
  // This is the identifier of the specific item within a subscription that this BillingItemState represents.
  // It is used for tracking the billing state of the item within its subscription.
  string subscription_item_id = 2;
}
