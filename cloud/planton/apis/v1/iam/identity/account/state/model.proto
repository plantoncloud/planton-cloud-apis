syntax = "proto3";

package cloud.planton.apis.v1.iam.identity.account.state;

import "cloud/planton/apis/v1/commons/audit/model.proto";
import "cloud/planton/apis/v1/commons/resource/model.proto";
import "cloud/planton/apis/v1/commons/resource/options/resource_options.proto";
import "cloud/planton/apis/v1/stack/state/model.proto";
import "cloud/planton/apis/v1/iam/identity/account/state/enums/enums.proto";

// identity-account state
message IdentityAccountState {
  option (cloud.planton.apis.v1.commons.resource.options.resource_type) = identity_account;

  // event_type is event that resulted in the new state which often is a result of processing a command
  cloud.planton.apis.v1.iam.identity.account.state.enums.IdentityAccountEventType event_type = 99;

  // resource api version
  string api_version = 1;

  // resource kind
  string kind = 2;

  // metadata for the resource
  // id:
  // (read-only) this is generated by idp provider.
  // for user accounts it can be in different formats.
  // * "auth0|<random-string>" when user signs up using email/password.
  // * "google-oauth|<random-string>" when user signs up using google.
  // for machine accounts it is the client_id of the oauth application created for the
  // m2m app on idp provider and is stored in the planton cloud database.
  //
  // name:
  //
  // name of the machine account.
  // name must match the regex '^[A-Za-z0-9-]{6,16}$'.
  // It represents a string of 6-16 alphanumeric characters or hyphens, with no spaces or other special characters.
  cloud.planton.apis.v1.commons.resource.Metadata metadata = 3;

  // resource spec
  IdentityAccountSpecState spec = 4;

  // resource status
  IdentityAccountStatusState status = 5;
}

// resource spec for identity-account
message IdentityAccountSpecState {
  // this is only relevant in case of machine identity accounts.
  // machine accounts are associated to companies on creation.
  string company_id = 1;
  // identity account type to identify with the account is for a machine or user
  string identity_account_type = 2;
  // email of the identity account.
  // (ignored for create) this value is assigned by planton backend.
  // the format for email for machine account is <machine-account-name>@<owner-id>.iam.pmachineaccount.com
  // <machine-account-name> is entered by user at the time of creation of machine accounts
  // (update not allowed)
  // email in case user account is based on the email used to signup to the application.
  string email = 3;
  // first name of the identity account this is more relevant in case of user accounts.
  // first name might be blank in case of machine accounts
  string first_name = 4;
  // last name of the identity account this is more relevant in case of user accounts.
  // last name might be blank in case of machine accounts
  string last_name = 5;
  // (read-only) url of the identity account on idp.
  // this is constructed when a client requests for the account object.
  // the format of the url for machine accounts is https://manage.auth0.com/dashboard/us/<auth0-tenant>/applications/<client-id>/settings
  // ex: https://manage.auth0.com/dashboard/us/planton-pcs-dev/applications/pKfND0v14bJRhk8XOFGVFY15H9gNHIov/settings
  // the format of the url for user accounts is https://manage.auth0.com/dashboard/us/<auth0-tenant>/users/<client-id>/settings
  // ex: https://manage.auth0.com/dashboard/us/planton-pcs-dev/users/pKfND0v14bJRhk8XOFGVFY15H9gNHIov/settings
  string idp_url = 6;
}

// resource status for identity-account
message IdentityAccountStatusState {
  // lifecycle of the resource
  cloud.planton.apis.v1.commons.resource.ResourceLifecycle lifecycle = 99;

  // system audit info
  cloud.planton.apis.v1.commons.audit.SysAudit sys_audit = 98;

  // stack-job that produced the status
  cloud.planton.apis.v1.stack.state.StackJobState stack_job = 97;
}

// https://auth0.com/docs/customize/log-streams/custom-log-streams
message Auth0WebhookState {
  string date = 1;
  string type = 2;
  string description = 3;
  string client_id = 4;
  string client_name = 5;
  string ip = 6;
  string user_agent = 7;
  string user_id = 8;
}
