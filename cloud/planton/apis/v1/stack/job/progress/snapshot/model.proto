syntax = "proto3";

package cloud.planton.apis.v1.stack.job.progress.snapshot;

message StackJobLogSnapshot {
  StackJobLogPulumiOperationSnapshot refresh_snapshot = 1;
  StackJobLogPulumiOperationSnapshot preview_snapshot = 2;
  StackJobLogPulumiOperationSnapshot apply_snapshot = 3;
  StackJobLogPulumiOperationSnapshot destroy_snapshot = 4;
}

message StackJobLogPulumiOperationProgress {
  bool is_started = 1;
  bool is_completed = 2;
  bool is_failed = 3;
  repeated string errors = 4;
}

message StackJobLogPulumiOperationSnapshot {
  StackJobLogPulumiOperationProgress progress = 1;
  PulumiOperationPreludeSnapshot prelude = 2;
  PulumiOperationResourceChangesSnapshot resource_changes = 3;
  PulumiOperationDiffSnapshot diff = 4;
  PulumiOperationDiagnosticsSnapshot diagnostics = 5;
  PulumiOperationSummarySnapshot summary = 6;
}

message PulumiOperationPreludeSnapshot {
  repeated string prelude_message = 1;
}

message PulumiOperationResourceChangesSnapshot {
  map<string,PulumiOperationResourceChangesSnapshotRow> urn_to_row_map = 1;
}

message PulumiOperationDiffSnapshot {
  repeated string resource_diff = 1;
}

message PulumiOperationDiagnosticsSnapshot {
  repeated string diagnostic_message = 1;
}

message PulumiOperationSummarySnapshot {
  int32 duration_seconds = 1;
  int32 unchanged_resource_count = 2;
  int32 create_resource_count = 3;
  int32 update_resource_count = 4;
  int32 delete_resource_count = 5;
  int32 replace_resource_count = 6;
}

message PulumiOperationResourceChangesSnapshotRow {
  string resource_type = 1;
  string resource_name = 2;
  string status = 3;
  bool is_done = 4;
  bool is_failed = 5;
  int64 elapsed_duration_seconds = 6;
}
